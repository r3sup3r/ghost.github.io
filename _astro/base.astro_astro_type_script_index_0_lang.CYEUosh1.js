const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["_astro/_menu_.DRe9SoLl.css"])))=>i.map(i=>d[i]);
import{c as T,B as v,N as I,d as C}from"./constants.Cd1PiS3e.js";import{p as S,u as k}from"./url.PttuBUox.js";import{i as B}from"./wallpaper.DGG9yh5i.js";import{i as H}from"./theme.B9CWhbmF.js";import{i as M}from"./hue.hyyDbmYh.js";import{_ as x}from"./preload-helper.BlTxHScW.js";import{l as P}from"./language.BQWhdQbz.js";import{b as w}from"./config.BFBf_zv3.js";import"./language.QW22jyx0.js";import"./zh.CkPLEEwR.js";function R(){typeof document>"u"||document.addEventListener("click",function(i){const t=i.target;if(t){if(t.classList.contains("copy-btn")||t.closest(".copy-btn")){const e=t.classList.contains("copy-btn")?t:t.closest(".copy-btn");if(!e)return;const n=e.parentElement?.querySelector("code");let s="";if(n){const a=n.querySelectorAll("span.line");if(a.length>0){const r=[];for(let o=0;o<a.length;o++){const h=a[o].textContent||"";r.push(h)}s=r.join(`
`)}else{const r=n.querySelectorAll(".code:not(summary *)");if(r.length>0){const o=[];for(let d=0;d<r.length;d++){const g=r[d].textContent||"";o.push(g)}s=o.join(`
`)}else s=n.textContent||""}}s=s.replace(/\n\n\n+/g,function(a){const o=a.length-1;let d;return o%2===0?d=o/2:d=Math.floor((o+1)/2),d<1&&(d=1),`
`.repeat(d+1)}),(async a=>{try{await navigator.clipboard.writeText(a)}catch(r){console.warn("Clipboard API 失败，尝试备用方案:",r);const o=document.createElement("textarea");o.value=a,o.style.position="fixed",o.style.left="-999999px",o.style.top="-999999px",document.body.appendChild(o),o.focus(),o.select();try{document.execCommand("copy")}catch(d){throw console.error("execCommand 也失败了:",d),new Error("所有复制方法都失败了")}finally{document.body.removeChild(o)}}})(s).then(()=>{const a=e.getAttribute("data-timeout-id");a&&clearTimeout(parseInt(a)),e.classList.add("success");const r=setTimeout(()=>{e.classList.remove("success")},1e3);e.setAttribute("data-timeout-id",r.toString())}).catch(a=>{console.error("复制失败:",a)})}if(t.classList.contains("collapse-btn")||t.closest(".collapse-btn")){const n=(t.classList.contains("collapse-btn")?t:t.closest(".collapse-btn"))?.closest(".expressive-code");n&&(n.classList.toggle("collapsed"),n.classList.toggle("expanded"))}}})}let u=[],m;async function L(){if(typeof document>"u")return;const i=".custom-md img:not(a *), #post-cover img:not(a *), .moment-images img:not(a *), .photo-gallery img:not(a *)",t=".moment-images a[data-fancybox], .photo-gallery a[data-fancybox]",e="[data-fancybox]:not(.moment-images a):not(.photo-gallery a)";if(!(document.querySelector(i)||document.querySelector(t)||document.querySelector(e))||(m||(m=(await x(()=>import("./index.Bgb2WQVn.js"),[])).Fancybox,await x(()=>Promise.resolve({}),__vite__mapDeps([0]))),u.length>0))return;const s={Thumbs:{autoStart:!0,showOnStart:"yes"},Toolbar:{display:{left:["infobar"],middle:["zoomIn","zoomOut","toggle1to1","rotateCCW","rotateCW","flipX","flipY"],right:["slideshow","thumbs","close"]}},animated:!0,dragToClose:!0,keyboard:{Escape:"close",Delete:"close",Backspace:"close",PageUp:"next",PageDown:"prev",ArrowUp:"next",ArrowDown:"prev",ArrowRight:"next",ArrowLeft:"prev"},fitToView:!0,preload:3,infinite:!0,Panzoom:{maxScale:3,minScale:1},caption:!1};m.bind(i,{...s,groupAll:!0,Carousel:{transition:"slide",preload:2}}),u.push(i),m.bind(t,{...s,source:c=>c.getAttribute("data-src")||c.getAttribute("href")}),u.push(t),m.bind(e,s),u.push(e)}function _(){m&&(u.forEach(i=>{m.unbind(i)}),u=[])}const p=100;class z{x;y;s;r;a;fn;idx;img;limitArray;config;constructor(t,e,n,s,c,a,r,o,d,h){this.x=t,this.y=e,this.s=n,this.r=s,this.a=c,this.fn=a,this.idx=r,this.img=o,this.limitArray=d,this.config=h}draw(t){t.save(),t.translate(this.x,this.y),t.rotate(this.r),t.globalAlpha=this.a,t.drawImage(this.img,0,0,40*this.s,40*this.s),t.restore()}update(){this.x=this.fn.x(this.x,this.y),this.y=this.fn.y(this.y,this.y),this.r=this.fn.r(this.r),this.a=this.fn.a(this.a),(this.x>window.innerWidth||this.x<0||this.y>window.innerHeight+p||this.y<-p||this.a<=0)&&(this.limitArray[this.idx]===-1?this.resetPosition():this.limitArray[this.idx]>0&&(this.resetPosition(),this.limitArray[this.idx]--))}resetPosition(){this.r=l("fnr",this.config),Math.random()>.4?(this.x=l("x",this.config),this.y=window.innerHeight+Math.random()*p,this.s=l("s",this.config),this.r=l("r",this.config),this.a=l("a",this.config)):(this.x=window.innerWidth,this.y=l("y",this.config),this.s=l("s",this.config),this.r=l("r",this.config),this.a=l("a",this.config))}}class F{list;constructor(){this.list=[]}push(t){this.list.push(t)}update(){for(let t=0,e=this.list.length;t<e;t++)this.list[t].update()}draw(t){for(let e=0,n=this.list.length;e<n;e++)this.list[e].draw(t)}get(t){return this.list[t]}size(){return this.list.length}}function l(i,t){let e,n;switch(i){case"x":e=Math.random()*window.innerWidth;break;case"y":e=window.innerHeight+Math.random()*p;break;case"s":e=t.size.min+Math.random()*(t.size.max-t.size.min);break;case"r":e=Math.random()*6;break;case"a":e=t.opacity.min+Math.random()*(t.opacity.max-t.opacity.min);break;case"fnx":n=t.speed.horizontal.min+Math.random()*(t.speed.horizontal.max-t.speed.horizontal.min),e=function(s,c){return s+n};break;case"fny":n=-(t.speed.vertical.min+Math.random()*(t.speed.vertical.max-t.speed.vertical.min)),e=function(s,c){return c+n};break;case"fnr":e=function(s){return s+t.speed.rotation*.1};break;case"fna":e=function(s){return s-t.speed.fadeSpeed*.01};break}return e}class N{config;canvas=null;ctx=null;particleList=null;animationId=null;img=null;isRunning=!1;constructor(t){this.config=t}async init(){typeof document>"u"||!this.config.enable||this.isRunning||(this.img=new Image,this.img.src="/assets/images/particle.png",await new Promise((t,e)=>{this.img&&(this.img.onload=()=>t(),this.img.onerror=()=>e(new Error("Failed to load particle image")))}),this.createCanvas(),this.createParticleList(),this.startAnimation(),this.isRunning=!0)}createCanvas(){typeof document>"u"||(this.canvas=document.createElement("canvas"),this.canvas.height=window.innerHeight,this.canvas.width=window.innerWidth,this.canvas.setAttribute("style",`position: fixed; left: 0; top: 0; pointer-events: none; z-index: ${this.config.zIndex};`),this.canvas.setAttribute("id","canvas_particle"),document.body.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),typeof window<"u"&&window.addEventListener("resize",this.handleResize.bind(this)))}createParticleList(){if(!this.img||!this.ctx)return;this.particleList=new F;const t=new Array(this.config.particleNum).fill(this.config.limitTimes);for(let e=0;e<this.config.particleNum;e++){const n=l("x",this.config),s=l("y",this.config),c=l("s",this.config),a=l("r",this.config),r=l("a",this.config),o=l("fnx",this.config),d=l("fny",this.config),h=l("fnr",this.config),g=l("fna",this.config),E=new z(n,s,c,a,r,{x:o,y:d,r:h,a:g},e,this.img,t,this.config);E.draw(this.ctx),this.particleList.push(E)}}startAnimation(){if(!this.ctx||!this.canvas||!this.particleList)return;const t=()=>{!this.ctx||!this.canvas||!this.particleList||(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.particleList.update(),this.particleList.draw(this.ctx),this.animationId=requestAnimationFrame(t))};this.animationId=requestAnimationFrame(t)}handleResize(){this.canvas&&(this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight)}stop(){this.animationId&&typeof window<"u"&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.canvas&&typeof document<"u"&&(document.body.removeChild(this.canvas),this.canvas=null),typeof window<"u"&&window.removeEventListener("resize",this.handleResize.bind(this)),this.isRunning=!1}toggle(){this.isRunning?this.stop():this.init()}updateConfig(t){const e=this.isRunning;e&&this.stop(),this.config=t,e&&t.enable&&this.init()}getIsRunning(){return this.isRunning}}let f=null;function D(i){f?f.updateConfig(i):(f=new N(i),i.enable&&f.init())}function q(){if(typeof window>"u")return;const i=()=>{!w||!w.enable||window.particleInitialized||(D(w),window.particleInitialized=!0)};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",i):i()}const A=()=>{window.swup.hooks.on("link:click",()=>{if(!!document.getElementById("banner-wrapper")){const t=document.getElementById("navbar-wrapper");if(t&&document.body.classList.contains("is-home")){const e=window.innerHeight*(v/100)-I;document.documentElement.scrollTop>=e&&t.classList.add("navbar-hidden")}}}),window.swup.hooks.on("content:replace",()=>{const i=document.getElementById("grid-class-carrier");if(i){const e=i.getAttribute("data-grid-class"),n=document.getElementById("main-grid");if(n&&e){const c=n.className.split(" ").filter(r=>!r.startsWith("lg:grid-cols-")&&!r.startsWith("md:grid-cols-")&&!r.startsWith("grid-cols-")),a=e.split(" ");n.className=[...c,...a].join(" ")}}const t=document.getElementById("navbar");t&&t.getAttribute("data-transparent-mode")==="semifull"&&typeof window.initSemifullScrollDetection=="function"&&window.initSemifullScrollDetection()}),window.swup.hooks.on("visit:start",i=>{window.scrollProtectionManager&&typeof window.scrollProtectionManager.disable=="function"&&window.scrollProtectionManager.disable();const t=document.querySelector("body"),e=S(i.to.url,k("/"));e?t.classList.add("is-home"):t.classList.remove("is-home");const n=document.querySelector(".banner-text-overlay");n&&(e?n.classList.remove("hidden"):n.classList.add("hidden"));const s=document.getElementById("navbar");s&&(s.setAttribute("data-is-home",e.toString()),s.getAttribute("data-transparent-mode")==="semifull"&&typeof window.initSemifullScrollDetection=="function"&&window.initSemifullScrollDetection());const c=document.getElementById("page-height-extend");c&&c.classList.remove("hidden")}),window.swup.hooks.on("visit:end",i=>{setTimeout(()=>{const t=document.getElementById("page-height-extend");t&&t.classList.add("hidden")},300)}),window.swup.hooks.on("page:view",()=>{window.scrollTo({top:0,behavior:"smooth"}),setTimeout(()=>{if(document.getElementById("tcomment")){const i=new CustomEvent("twilight:page:loaded",{detail:{path:window.location.pathname,timestamp:Date.now()}});document.dispatchEvent(i)}},300),L()}),L(),window.swup.hooks.on("content:replace",()=>{_()},{before:!0})};window?.swup?.hooks?A():document.addEventListener("swup:enable",A);let y=document.getElementById("navbar-wrapper"),b=document.getElementById("back-to-top-btn");function W(i,t){let e;return function(...n){e||(i.apply(this,n),e=!0,setTimeout(()=>e=!1,t))}}function O(){const i=document.documentElement.scrollTop,t=window.innerHeight*(v/100),e=!!document.getElementById("banner-wrapper");requestAnimationFrame(()=>{if(b&&(i>t?b.classList.remove("hide"):b.classList.add("hide")),e&&y){const s=document.body.classList.contains("is-home")?C:v,c=window.innerHeight*(s/100)-I;i>=c?y.classList.add("navbar-hidden"):y.classList.remove("navbar-hidden")}})}window.onscroll=W(O,16);window.onresize=()=>{let i=Math.floor(window.innerHeight*(T/100));i=i-i%4,document.documentElement.style.setProperty("--banner-height-extend",`${i}px`)};H();M();B();R();P();q();typeof window<"u"&&window.addEventListener("load",()=>{const i=document.getElementById("loading-overlay"),t=document.body.classList.contains("enable-banner");i&&i.classList.add("fade-out"),setTimeout(()=>{i&&(i.style.display="none"),t?(document.documentElement.classList.add("banner-restoring"),setTimeout(()=>{document.documentElement.classList.remove("is-loading"),document.documentElement.classList.add("show-initial-animation"),setTimeout(()=>{document.documentElement.classList.remove("show-initial-animation"),document.documentElement.classList.remove("banner-restoring")},1200)},600)):(document.documentElement.classList.remove("is-loading"),document.documentElement.classList.add("show-initial-animation"),setTimeout(()=>{document.documentElement.classList.remove("show-initial-animation")},1200))},600)});
