(function(m){const i="umami-share-cache";async function h(e,a,r){const t=localStorage.getItem(i);if(t)try{const w=JSON.parse(t);if(Date.now()-w.timestamp<36e5)return w.value}catch{localStorage.removeItem(i)}const n=Date.now(),c=`${e}/v1/websites/${r}/stats?startAt=0&endAt=${n}`,s=await fetch(c,{headers:{"x-umami-api-key":a}});if(!s.ok)throw new Error("获取网站统计数据失败");const o=await s.json();return localStorage.setItem(i,JSON.stringify({timestamp:Date.now(),value:o})),o}async function u(e,a,r,t,n=0,c=Date.now()){const s=`${e}/v1/websites/${r}/stats?startAt=${n}&endAt=${c}&url=${encodeURIComponent(t)}`,o=await fetch(s,{headers:{"x-umami-api-key":a}});if(!o.ok)throw new Error("获取页面统计数据失败");return await o.json()}m.getUmamiWebsiteStats=async function(e,a,r){try{return await h(e,a,r)}catch(t){throw new Error(`获取Umami统计数据失败: ${t.message}`)}},m.getUmamiPageStats=async function(e,a,r,t,n,c){try{return await u(e,a,r,t,n,c)}catch(s){throw new Error(`获取Umami页面统计数据失败: ${s.message}`)}},m.clearUmamiShareCache=function(){localStorage.removeItem(i)}})(window);
